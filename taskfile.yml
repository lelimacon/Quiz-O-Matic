version: '3'

includes:
  app: ./app/taskfile.yml
  template: ./template/taskfile.yml

vars:
  # Shell workaround.
  SHELL: '{{if eq .OS "Windows_NT"}}wsl{{end}}'

tasks:

  build:
    desc: Build the app to out folder
    cmds:
      - task: app:build
      - task: template:build

  watch:
    desc: Rebuild when sources change
    watch: true
    sources:
      - app/src/**/*
      - template/**/*
    generates:
      - out/www/app.js
    cmds:
      - task: build

  serve:
    desc: Serve the output app (requires serve-handler)
    cmds:
      - task: build
      - serve --no-clipboard "out/www/"

  clean:
    desc: Remove ALL generated files
    cmds:
      - '{{.SHELL}} rm -rf out/'
      - task: template:clean
      - task: app:clean-docker
